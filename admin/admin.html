<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Bella Exchange</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      background: #0b132b;
      color: #ffffff;
      min-height: 100vh;
    }

    .header {
      background: #0d1b3d;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      color: #ffd700;
      font-weight: bold;
      font-size: 24px;
    }

    .stats-bar {
      display: flex;
      gap: 20px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-label {
      color: #cbd5f5;
      font-size: 12px;
    }

    .stat-value {
      color: #ffd700;
      font-size: 20px;
      font-weight: bold;
    }

    .container {
      max-width: 1400px;
      margin: 30px auto;
      padding: 0 20px;
    }

    .filters {
      background: #101e4a;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .filter-label {
      color: #cbd5f5;
      font-size: 12px;
      font-weight: bold;
    }

    select, input {
      padding: 10px;
      border-radius: 6px;
      border: 2px solid #1e3a6f;
      background: #0d1b3d;
      color: #ffffff;
      font-size: 14px;
    }

    .refresh-btn {
      padding: 10px 20px;
      background: #ffd700;
      color: #000;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      margin-top: auto;
    }

    .refresh-btn:hover {
      background: #ffed4e;
    }

    .orders-grid {
      display: grid;
      gap: 15px;
    }

    .order-card {
      background: #101e4a;
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid #ffd700;
      transition: 0.3s;
    }

    .order-card:hover {
      transform: translateX(5px);
      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.2);
    }

    .order-card.vente {
      border-left-color: #25D366;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .order-number {
      color: #ffd700;
      font-size: 18px;
      font-weight: bold;
    }

    .order-type {
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }

    .order-type.achat {
      background: #ffd700;
      color: #000;
    }

    .order-type.vente {
      background: #25D366;
      color: #fff;
    }

    .order-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }

    .detail-item {
      background: #0d1b3d;
      padding: 12px;
      border-radius: 6px;
    }

    .detail-label {
      color: #cbd5f5;
      font-size: 12px;
      margin-bottom: 5px;
    }

    .detail-value {
      color: #ffd700;
      font-weight: bold;
      font-size: 14px;
      word-break: break-all;
    }

    .order-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      font-size: 14px;
    }

    .btn-view {
      background: #1e3a6f;
      color: #fff;
    }

    .btn-view:hover {
      background: #2a4a8f;
    }

    .btn-complete {
      background: #25D366;
      color: #fff;
    }

    .btn-complete:hover {
      background: #20ba5a;
    }

    .btn-cancel {
      background: #ff4444;
      color: #fff;
    }

    .btn-cancel:hover {
      background: #cc0000;
    }

    .status-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
      display: inline-block;
    }

    .status-en_attente {
      background: #ff8c00;
      color: #000;
    }

    .status-en_cours {
      background: #4a90e2;
      color: #fff;
    }

    .status-completee {
      background: #25D366;
      color: #fff;
    }

    .status-annulee {
      background: #ff4444;
      color: #fff;
    }

    .loading {
      text-align: center;
      padding: 50px;
    }

    .spinner {
      border: 4px solid #1e3a6f;
      border-top: 4px solid #ffd700;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 50px;
      color: #cbd5f5;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: #101e4a;
      border-radius: 12px;
      padding: 30px;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #ff4444;
      color: #fff;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
    }

    .screenshot-img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 15px;
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 15px;
      }

      .filters {
        flex-direction: column;
      }

      .order-details {
        grid-template-columns: 1fr;
      }

      .modal-content {
        margin: 20px;
        padding: 20px;
      }
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-content">
      <div class="logo">üîß Admin Dashboard - Bella Exchange</div>
      <div class="stats-bar">
        <div class="stat-item">
          <div class="stat-label">Total commandes</div>
          <div class="stat-value" id="totalOrders">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">En attente</div>
          <div class="stat-value" id="pendingOrders">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Compl√©t√©es</div>
          <div class="stat-value" id="completedOrders">0</div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    
    <div class="filters">
      <div class="filter-group">
        <label class="filter-label">Type</label>
        <select id="filterType">
          <option value="">Tous</option>
          <option value="ACHAT">Achat</option>
          <option value="VENTE">Vente</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Statut</label>
        <select id="filterStatus">
          <option value="">Tous</option>
          <option value="EN_ATTENTE">En attente</option>
          <option value="EN_COURS">En cours</option>
          <option value="COMPLETEE">Compl√©t√©e</option>
          <option value="ANNULEE">Annul√©e</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Crypto</label>
        <select id="filterCrypto">
          <option value="">Toutes</option>
          <option value="BTC">BTC</option>
          <option value="ETH">ETH</option>
          <option value="BNB">BNB</option>
          <option value="USDT">USDT</option>
        </select>
      </div>

      <button class="refresh-btn" onclick="loadOrders()">üîÑ Actualiser</button>
    </div>

    <div id="ordersContainer">
      <div class="loading">
        <div class="spinner"></div>
        <p style="color: #cbd5f5;">Chargement des commandes...</p>
      </div>
    </div>

  </div>

  <!-- Modal pour voir les d√©tails -->
  <div class="modal" id="orderModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">√ó</button>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    // üîß CONFIGURATION
    const API_URL = 'https://bella-exchange-backend.onrender.com/api/orders';

    let allOrders = [];

    async function loadOrders() {
      try {
        const response = await fetch(API_URL);
        const result = await response.json();

        if (result.success) {
          allOrders = result.orders;
          updateStats();
          displayOrders();
        }
      } catch (error) {
        console.error('Erreur:', error);
        document.getElementById('ordersContainer').innerHTML = `
          <div class="empty-state">
            <p style="font-size: 48px;">‚ùå</p>
            <p>Erreur de connexion au serveur</p>
          </div>
        `;
      }
    }

    function updateStats() {
      document.getElementById('totalOrders').textContent = allOrders.length;
      document.getElementById('pendingOrders').textContent = 
        allOrders.filter(o => o.status === 'EN_ATTENTE').length;
      document.getElementById('completedOrders').textContent = 
        allOrders.filter(o => o.status === 'COMPLETEE').length;
    }

    function displayOrders() {
      const filterType = document.getElementById('filterType').value;
      const filterStatus = document.getElementById('filterStatus').value;
      const filterCrypto = document.getElementById('filterCrypto').value;

      let filtered = allOrders;

      if (filterType) {
        filtered = filtered.filter(o => o.type === filterType);
      }
      if (filterStatus) {
        filtered = filtered.filter(o => o.status === filterStatus);
      }
      if (filterCrypto) {
        filtered = filtered.filter(o => o.crypto === filterCrypto);
      }

      const container = document.getElementById('ordersContainer');

      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <p style="font-size: 48px;">üì≠</p>
            <p>Aucune commande trouv√©e</p>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <div class="orders-grid">
          ${filtered.map(order => createOrderCard(order)).join('')}
        </div>
      `;
    }

    function createOrderCard(order) {
      const date = new Date(order.createdAt).toLocaleString('fr-FR');
      
      return `
        <div class="order-card ${order.type.toLowerCase()}">
          <div class="order-header">
            <div class="order-number">${order.orderNumber}</div>
            <div>
              <span class="order-type ${order.type.toLowerCase()}">${order.type}</span>
              <span class="status-badge status-${order.status.toLowerCase()}">${order.status.replace('_', ' ')}</span>
            </div>
          </div>

          <div class="order-details">
            <div class="detail-item">
              <div class="detail-label">Crypto</div>
              <div class="detail-value">${order.crypto}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Montant USD</div>
              <div class="detail-value">$${order.amountUSD}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Montant CFA</div>
              <div class="detail-value">${order.amountCFA}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Date</div>
              <div class="detail-value" style="font-size: 12px;">${date}</div>
            </div>
            ${order.walletAddress ? `
            <div class="detail-item">
              <div class="detail-label">Adresse wallet</div>
              <div class="detail-value" style="font-size: 11px;">${order.walletAddress}</div>
            </div>
            ` : ''}
            ${order.phoneNumber ? `
            <div class="detail-item">
              <div class="detail-label">T√©l√©phone</div>
              <div class="detail-value">${order.phoneNumber}</div>
            </div>
            ` : ''}
          </div>

          <div class="order-actions">
            <button class="btn btn-view" onclick='viewOrder(${JSON.stringify(order).replace(/'/g, "\\'")})''>
              üëÅÔ∏è Voir d√©tails
            </button>
            ${order.status !== 'COMPLETEE' ? `
              <button class="btn btn-complete" onclick="updateStatus('${order.orderNumber}', 'COMPLETEE')">
                ‚úÖ Marquer comme compl√©t√©
              </button>
            ` : ''}
            ${order.status !== 'ANNULEE' ? `
              <button class="btn btn-cancel" onclick="updateStatus('${order.orderNumber}', 'ANNULEE')">
                ‚ùå Annuler
              </button>
            ` : ''}
          </div>
        </div>
      `;
    }

    function viewOrder(order) {
      const modal = document.getElementById('orderModal');
      const modalContent = document.getElementById('modalContent');

      modalContent.innerHTML = `
        <h2 style="color: #ffd700; margin-bottom: 20px;">D√©tails de la commande</h2>
        
        <div style="background: #0d1b3d; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <p><strong style="color: #cbd5f5;">Num√©ro:</strong> <span style="color: #ffd700;">${order.orderNumber}</span></p>
          <p><strong style="color: #cbd5f5;">Type:</strong> <span style="color: #ffd700;">${order.type}</span></p>
          <p><strong style="color: #cbd5f5;">Statut:</strong> <span style="color: #ffd700;">${order.status}</span></p>
          <p><strong style="color: #cbd5f5;">Crypto:</strong> <span style="color: #ffd700;">${order.crypto}</span></p>
          <p><strong style="color: #cbd5f5;">Montant:</strong> <span style="color: #ffd700;">$${order.amountUSD} (${order.amountCFA})</span></p>
          ${order.walletAddress ? `<p><strong style="color: #cbd5f5;">Adresse wallet:</strong> <span style="color: #ffd700; word-break: break-all;">${order.walletAddress}</span></p>` : ''}
          ${order.phoneNumber ? `<p><strong style="color: #cbd5f5;">T√©l√©phone:</strong> <span style="color: #ffd700;">${order.phoneNumber}</span></p>` : ''}
        </div>

        <h3 style="color: #ffd700; margin-bottom: 10px;">Capture d'√©cran</h3>
        <img src="${order.screenshotUrl}" class="screenshot-img" alt="Capture transaction">
      `;

      modal.classList.add('active');
    }

    function closeModal() {
      document.getElementById('orderModal').classList.remove('active');
    }

    async function updateStatus(orderNumber, status) {
      if (!confirm(`√ätes-vous s√ªr de vouloir changer le statut vers "${status}" ?`)) {
        return;
      }

      try {
        const response = await fetch(`${API_URL}/${orderNumber}/status`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ status })
        });

        const result = await response.json();

        if (result.success) {
          alert('‚úÖ Statut mis √† jour avec succ√®s !');
          loadOrders();
        } else {
          alert('‚ùå Erreur lors de la mise √† jour');
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('‚ùå Erreur de connexion');
      }
    }

    // Event listeners pour les filtres
    document.getElementById('filterType').addEventListener('change', displayOrders);
    document.getElementById('filterStatus').addEventListener('change', displayOrders);
    document.getElementById('filterCrypto').addEventListener('change', displayOrders);

    // Fermer le modal en cliquant en dehors
    document.getElementById('orderModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    // Charger les commandes au d√©marrage
    loadOrders();

    // Auto-refresh toutes les 30 secondes
    setInterval(loadOrders, 30000);
  </script>

</body>
</html>